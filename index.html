<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Проверка доменов</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--tg-theme-bg-color, #fff);
            color: var(--tg-theme-text-color, #000);
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: var(--tg-theme-text-color, #000);
        }

        input[type="text"], input[type="password"], button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid var(--tg-theme-hint-color, #ccc);
            border-radius: 4px;
            font-size: 16px;
            background-color: var(--tg-theme-secondary-bg-color, #f4f4f4);
            color: var(--tg-theme-text-color, #000);
        }

        button {
            background-color: var(--tg-theme-button-color, #4CAF50);
            color: var(--tg-theme-button-text-color, #fff);
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: var(--tg-theme-button-color, #45a049);
        }

        .result {
            margin-top: 20px;
        }

        .result p {
            font-size: 16px;
            color: var(--tg-theme-text-color, #000);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }
    </style>
</head>
<body>

<div class="container">
    <!-- Страница авторизации -->
    <div id="authPage" class="page active">
        <h1>Авторизация</h1>
        <form id="loginForm">
            <input type="text" id="login" placeholder="Логин" required>
            <input type="password" id="password" placeholder="Пароль" required>
            <button type="submit">Войти</button>
        </form>
        <button id="registerBtn">Регистрация</button>
    </div>

    <!-- Страница регистрации -->
    <div id="registerPage" class="page">
        <h1>Регистрация</h1>
        <form id="registerForm">
            <input type="text" id="regLogin" placeholder="Логин" required>
            <input type="password" id="regPassword" placeholder="Пароль" required>
            <button type="submit">Зарегистрироваться</button>
        </form>
        <button id="backToLoginBtn">Назад к авторизации</button>
    </div>

    <!-- Страница поиска доменов -->
    <div id="searchPage" class="page">
        <h1>Проверка доменов</h1>
        <form id="domainForm">
            <input type="text" id="domainName" placeholder="Введите домен без расширения" required>
            <button type="submit">Проверить</button>
        </form>
        <div class="result" id="result"></div>
    </div>

    <!-- Страница управления доменом -->
    <div id="managePage" class="page">
        <h1>Управление доменом</h1>
        <div id="domainInfo"></div>
        <button id="backToSearchBtn">Назад к поиску</button>
    </div>
</div>

<script>
    // Инициализация Telegram Web App
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();

    // Текущий пользователь (для демонстрации)
    let currentUser = null;

    // Навигация между страницами
    function showPage(pageId) {
        $(".page").removeClass("active");
        $(`#${pageId}`).addClass("active");
    }

    // Авторизация через Telegram
    function authViaTelegram() {
        const initData = Telegram.WebApp.initData;
        if (initData) {
            const user = JSON.parse(initData).user;
            if (user) {
                currentUser = user;
                showPage("searchPage");
            }
        }
    }

    // Обработка формы авторизации
    $("#loginForm").on("submit", function (e) {
        e.preventDefault();
        const login = $("#login").val();
        const password = $("#password").val();

        // Здесь можно добавить запрос к API для проверки логина и пароля
        if (login && password) {
            currentUser = { username: login };
            showPage("searchPage");
        } else {
            alert("Неверный логин или пароль.");
        }
    });

    // Обработка формы регистрации
    $("#registerForm").on("submit", function (e) {
        e.preventDefault();
        const login = $("#regLogin").val();
        const password = $("#regPassword").val();

        // Здесь можно добавить запрос к API для регистрации
        if (login && password) {
            currentUser = { username: login };
            showPage("searchPage");
        } else {
            alert("Заполните все поля.");
        }
    });

    // Переход на страницу регистрации
    $("#registerBtn").on("click", function () {
        showPage("registerPage");
    });

    // Возврат на страницу авторизации
    $("#backToLoginBtn").on("click", function () {
        showPage("authPage");
    });

    // Возврат на страницу поиска
    $("#backToSearchBtn").on("click", function () {
        showPage("searchPage");
    });

    // Проверка домена
    $("#domainForm").on("submit", function (e) {
        e.preventDefault();
        const name = $("#domainName").val().trim();
        if (!name) return;

        fetch(`/check?name=${name}`)
            .then(response => response.json())
            .then(data => {
                let resultHTML = '';
                for (let domain in data) {
                    resultHTML += `<p><strong>${domain}:</strong> ${data[domain].slice(0, 4)}</p>`;
                    if (data[domain][4] === true) {
                        resultHTML += `<button id='${domain}' class='buyBtn'>Купить</button>`;
                    }
                }
                $("#result").html(resultHTML);

                // Обработка кнопки "Купить"
                $(".buyBtn").on("click", function () {
                    const domain = $(this).attr("id");
                    fetch(`/buy/${domain}`, { method: "POST" })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                alert(`Домен ${domain} успешно куплен!`);
                                showPage("managePage");
                                $("#domainInfo").html(`<p>Домен: ${domain}</p>`);
                            } else {
                                alert("Ошибка при покупке домена.");
                            }
                        });
                });
            })
            .catch(error => {
                $("#result").html("<p>Ошибка при проверке доменов. Попробуйте позже.</p>");
            });
    });

    // Авторизация через Telegram при загрузке
    authViaTelegram();
</script>

</body>
</html>